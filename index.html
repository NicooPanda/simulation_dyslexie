<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulation de la dyslexie avancée</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            font-size: 26px;
            line-height: 1.6;
            padding: 50px;
            background-color: #f8f8f8;
            color: #222;
            text-align: justify;
        }

        .container {
            max-width: 900px;
            margin: auto;
        }

        .controls {
            margin-bottom: 30px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .input-group {
            width: 100%;
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-size: 18px;
        }

        input[type="text"],
        textarea {
            width: 100%;
            padding: 10px;
            font-size: 18px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        textarea {
            height: 120px;
            resize: vertical;
        }

        input[type="range"] {
            width: 100%;
            -webkit-appearance: none;
            height: 8px;
            border-radius: 5px;
            background: #d3d3d3;
            outline: none;
            opacity: 0.7;
            -webkit-transition: .2s;
            transition: opacity .2s;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #007BFF;
            cursor: pointer;
        }

        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #007BFF;
            cursor: pointer;
        }

        .buttons {
            display: flex;
            gap: 15px;
        }

        button {
            padding: 10px 20px;
            font-size: 18px;
            cursor: pointer;
            background-color: #007BFF;
            color: white;
            border: none;
            border-radius: 5px;
            transition: background-color 0.3s ease, opacity 0.3s ease;
        }

        button:hover:not(:disabled) {
            background-color: #0056b3;
        }
        
        button:disabled {
            background-color: #aaa;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .dyslexic-text {
            border: 2px solid #ddd;
            padding: 20px;
            border-radius: 8px;
            min-height: 100px;
        }

        h1 {
            text-align: center;
            margin-bottom: 20px;
        }

        .word {
            display: inline-block;
            margin-right: 8px;
            position: relative;
            transition: all 0.3s ease-out;
        }
        
        .letter {
            display: inline-block;
            position: relative;
            transition: transform 0.2s ease-out, filter 0.2s ease-out, margin 0.2s ease-out;
        }

        .flipped {
            transform: scaleX(-1);
        }

        .jumped {
            transform: translateY(-5px);
        }

        .crowded {
            margin-right: -5px;
        }

        .blurred {
            filter: blur(1.5px);
        }
    </style>
</head>
<body>

    <div class="container">
        <nav style="text-align: center; margin-bottom: 20px;">
            <a href="exercice.html" style="font-size: 20px; text-decoration: none; color: #007BFF;">Accéder à l'exercice</a>
        </nav>
        <h1 id="page-title">Symptomatologie de la dyslexie</h1>
        <div class="dyslexic-text">
            <p id="simulated-text"></p>
        </div>
        <div class="controls">
            <div class="input-group">
                <label for="speed-slider">Vitesse des effets : <span id="speed-value">Moyenne</span></label>
                <input type="range" id="speed-slider" min="1" max="100" value="50" />
            </div>
            <div class="buttons">
                <button id="start-button">Démarrer la simulation</button>
                <button id="stop-button">Arrêter la simulation</button>
            </div>
            <div class="input-group">
                <label for="title-input">Titre de la page :</label>
                <input type="text" id="title-input" value="Symptomatologie de la dyslexie" />
            </div>
            <div class="input-group">
                <label for="text-input">Texte à simuler :</label>
                <textarea id="text-input">La dyslexie peut se manifester comme production retardée du langage, difficultés d'articulation, difficultés à se rappeler les noms des lettres, des nombres et des couleurs, difficultés avec les problèmes de mots malgré des compétences normales en calcul mathématique. Ces enfants présentant des problèmes phonologiques ont souvent des difficultés à allier des sons, à faire rimer les mots, à identifier la position des sons au sein des mots et à segmenter les mots en syllabes. Ils peuvent inverser l'ordre des sons dans les mots. Les hésitations et la lenteur dans le choix des mots, les substitutions de mots, les difficultés à nommer les lettres et les images sont des signes précoces fréquents. Les troubles de la mémoire auditive à court terme et du séquençage auditif sont habituels.</textarea>
            </div>
        </div>
    </div>

    <script>
        const pageTitleElement = document.getElementById('page-title');
        const titleInput = document.getElementById('title-input');
        const textElement = document.getElementById('simulated-text');
        const textInput = document.getElementById('text-input');
        const startButton = document.getElementById('start-button');
        const stopButton = document.getElementById('stop-button');
        const speedSlider = document.getElementById('speed-slider');
        const speedValueSpan = document.getElementById('speed-value');
        let intervalId;

        // Mappage des valeurs du slider à des libellés de vitesse pour une meilleure UX
        const speedLabels = {
            '1': 'Très lente', '10': 'Lente', '30': 'Modérée', '50': 'Moyenne',
            '70': 'Rapide', '90': 'Très rapide', '100': 'Extrême'
        };

        function getIntervalDelay(sliderValue) {
            // Inverser la logique : plus la valeur du slider est grande, plus le délai est petit (plus rapide)
            // Range du slider: 1 à 100
            // Range de délai souhaité: 50ms (très rapide) à 1000ms (très lente)
            // Formule: max_delay - ((slider_value - min_slider_value) / (max_slider_value - min_slider_value)) * (max_delay - min_delay)
            const minSlider = 1;
            const maxSlider = 100;
            const minDelay = 50; // Délai le plus court (le plus rapide)
            const maxDelay = 1000; // Délai le plus long (le plus lent)

            return maxDelay - ((sliderValue - minSlider) / (maxSlider - minSlider)) * (maxDelay - minDelay);
        }

        function createHtmlElements(element, text) {
            const words = text.trim().split(/\s+/);
            let htmlContent = '';
            words.forEach(word => {
                let lettersHtml = '';
                for (const char of word) {
                    lettersHtml += `<span class="letter">${char}</span>`;
                }
                htmlContent += `<span class="word">${lettersHtml}</span> `;
            });
            element.innerHTML = htmlContent;
        }
        
        function applyRandomEffects() {
            // Sélectionne tous les mots, y compris ceux du titre
            const allElements = document.querySelectorAll('.word, #page-title .word'); 
            allElements.forEach(word => {
                const lettersInWord = word.querySelectorAll('.letter');
                
                // Effet de mélange (scrambling)
                if (Math.random() < 0.15 && lettersInWord.length > 2) {
                    const middlePart = Array.from(lettersInWord).slice(1, lettersInWord.length - 1);
                    // Shuffle Fisher-Yates pour le milieu du mot
                    for (let i = middlePart.length - 1; i > 0; i--) {
                        const j = Math.floor(Math.random() * (i + 1));
                        [middlePart[i].textContent, middlePart[j].textContent] = [middlePart[j].textContent, middlePart[i].textContent];
                    }
                }

                lettersInWord.forEach(letter => {
                    letter.className = 'letter'; // Réinitialise les classes à chaque cycle

                    // Effet de saut (jumping)
                    if (Math.random() < 0.05) {
                        letter.classList.add('jumped');
                    }
                    
                    // Effet de retournement (flipping)
                    if (Math.random() < 0.02) {
                        letter.classList.add('flipped');
                    }

                    // Effet de chevauchement (crowding)
                    if (Math.random() < 0.03) {
                        letter.classList.add('crowded');
                    }

                    // Effet de flou (blurring)
                    if (Math.random() < 0.02) {
                        letter.classList.add('blurred');
                    }
                });
            });
        }

        function startSimulation() {
            if (intervalId) {
                clearInterval(intervalId);
            }
            
            const currentSpeedValue = parseInt(speedSlider.value);
            const delay = getIntervalDelay(currentSpeedValue);

            createHtmlElements(pageTitleElement, titleInput.value);
            createHtmlElements(textElement, textInput.value);
            
            intervalId = setInterval(applyRandomEffects, delay);
            
            startButton.disabled = true;
            stopButton.disabled = false;
        }

        function stopSimulation() {
            if (intervalId) {
                clearInterval(intervalId);
            }
            startButton.disabled = false;
            stopButton.disabled = true;
        }

        // Met à jour l'affichage de la valeur du curseur
        speedSlider.addEventListener('input', () => {
            const sliderValue = parseInt(speedSlider.value);
            // Trouver le libellé le plus proche ou exact
            let label = speedLabels[sliderValue] || 'Personnalisée';
            
            // Si la valeur est entre deux étiquettes, on peut donner une indication
            if (label === 'Personnalisée') {
                const closestValue = Object.keys(speedLabels).reduce((prev, curr) => 
                    (Math.abs(curr - sliderValue) < Math.abs(prev - sliderValue) ? curr : prev)
                );
                if (Math.abs(closestValue - sliderValue) < 10) { // Si proche d'une étiquette existante
                    label = `~${speedLabels[closestValue]}`;
                } else {
                    label = `${getIntervalDelay(sliderValue).toFixed(0)} ms`;
                }
            }

            speedValueSpan.textContent = label;
            // Relancer la simulation immédiatement avec la nouvelle vitesse
            startSimulation(); 
        });

        // Gère le démarrage initial et le clic sur les boutons
        document.addEventListener('DOMContentLoaded', () => {
            stopButton.disabled = true;
            // Initialise le libellé de vitesse au chargement
            speedValueSpan.textContent = speedLabels[speedSlider.value] || 'Moyenne';
            startSimulation();
        });

        startButton.addEventListener('click', startSimulation);
        stopButton.addEventListener('click', stopSimulation);
    </script>
</body>
</html>
